<main class="w-full h-full overflow-hidden px-12 py-8">
    <h1 class="font-medium text-4xl">Admins</h1>
    <div class="size-full flex mt-16 items-center flex-col">
        @if (adminService.adminsQuery.isLoading()){
            <span class="loading loading-bars size-16"></span>
        }

        @if(adminService.adminsQuery.isError()){
            <div class="alert min-w-80 alert-error flex flex-col py-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="size-20"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/><path d="M11 7v4"/><path d="M11 15h.01"/></svg>
                <span class="text-lg">Error loading admins!</span>
            </div>
        }

        @if(adminService.adminsQuery.isSuccess()){
            <table class="table w-full">
                <thead>
                    <tr class="bg-base-200">
                        <th></th>
                        <th>Username</th>
                        <th>Access level</th>
                        <th>Created At</th>
                        <th>Updated At</th>
                    </tr>
                </thead>
                <tbody>
                    @for(admin of (adminService.adminsQuery.data() || []); track admin.id){
                        <tr class="hover:bg-base-200 transition-all duration-300">
                            <td>
                                <input class="checkbox" type="checkbox" [checked]="selectedAdminId === admin.id"
                                       (change)="toggleSelection(admin.id!)"/>
                            </td>
                            <td>{{admin.username}}</td>
                            <td>{{admin.accessLevel == 0 ? "Read" : "Write"}}</td>
                            <td>{{ admin.createdAt | date:'yyyy-MM-dd HH:mm' }}</td>
                            <td>{{admin.updatedAt | date: 'yyyy-MM-dd HH:mm' }}</td>
                        </tr>
                    }@empty{
                        <tr>
                            <td colspan="4" class="text-center p-10 text-base-content/50">No admins found.</td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="m-4 p-2 w-full gap-4 flex">
                <label for="create-modal"
                       class="btn btn-outline btn-accent">
                    Create
                </label>
                <label for="modify-modal"
                       class="btn btn-outline btn-warning"
                       [class.btn-disabled]="!selectedAdminId">
                    Modify
                </label>
                <label for="password-modal"
                       class="btn btn-outline btn-warning"
                       [class.btn-disabled]="!selectedAdminId">
                    Change Password
                </label>
                <button class="btn btn-outline btn-error" (click)="onDelete()" [disabled]="!selectedAdminId">Delete</button>
            </div>
        }

    </div>
</main>

<input type="checkbox" id="modify-modal" class="modal-toggle" />
<div class="modal" role="dialog">
    <div class="modal-box">
        <h3 class="text-lg font-bold">Modify Admin: {{ selectedAdmin?.username }}</h3>
        <app-admin-form [form]="updateAdminForm" [admin]="selectedAdmin"></app-admin-form>
        <div class="modal-action">
            <label for="modify-modal" class="btn">Close</label>
            <button class="btn btn-warning" [disabled]="adminService.updateAdmin.isPending()" (click)="onUpdateSubmit()">Save Changes</button>
        </div>
    </div>
</div>

<input type="checkbox" id="create-modal" class="modal-toggle" />
<div class="modal" role="dialog">
    <div class="modal-box">
        <h3 class="text-lg font-bold">Create Admin</h3>
        <app-admin-form [password]="true" [form]="createAdminForm"></app-admin-form>
        <div class="modal-action">
            <label for="create-modal" class="btn">Close</label>
            <button class="btn btn-warning" [disabled]="adminService.createAdmin.isPending()" (click)="onCreateSubmit()">Save Changes</button>
        </div>
    </div>
</div>

<input type="checkbox" id="password-modal" class="modal-toggle" />
<div class="modal" role="dialog">
    <div class="modal-box">
        <h3 class="text-lg font-bold">Change Password for Admin: {{selectedAdmin?.username}}</h3>
        <app-password-form [form]="changePasswordForm"></app-password-form>
        <div class="modal-action">
            <label for="password-modal" class="btn">Close</label>
            <button class="btn btn-warning" [disabled]="adminService.updateAdminPassword.isPending()"  (click)="onChangePasswordSubmit()">Save Changes</button>
        </div>
    </div>
</div>
